import os

#def SymLink(target, source, env):
#    '''Define Action to create symlinks'''
#    os.symlink(os.path.abspath(str(source[0])), os.path.abspath(str(target[0])))

Import('*')

statistics_dir = 'read_statistics'
make_statistics_dir = env.Command(Dir(statistics_dir), [], Mkdir('$TARGET'))

readset = env['FILE_TO_PROCESS']
readset_basename = os.path.splitext(os.path.basename(readset))[0]
readset_ext = os.path.splitext(os.path.basename(readset))[1]
fastx_quality_stats_cmd = 'fastx_quality_stats -N > $TARGET'
if readset_ext == '.gz':
    pre_cmd = 'zcat $SOURCE | '
else:
    pre_cmd = 'cat $SOURCE | '

fastx_quality_stats = env.Command(os.path.join(statistics_dir, 
                                              readset_basename + 
                                              '.fastx_quality_stats.tsv'), 
                                 readset, pre_cmd + fastx_quality_stats_cmd)
Return('fastx_quality_stats')

